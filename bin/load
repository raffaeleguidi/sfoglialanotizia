#!/usr/bin/env node

const jsonfile = require('jsonfile');
const feeds = require('../lib/feeds');

feeds.init();

const refresh = () => {
    feeds.refresh((articles, corpus) => {
        console.log(new Date(), "refresh loaded", articles.length, "articles");
    });
};

refresh();

const intervalStr = process.env.EVERY || "5m";
let intervalMs = 5 * 60 * 1000; // Default 5m

if (intervalStr.endsWith('m')) {
    intervalMs = parseInt(intervalStr) * 60 * 1000;
} else if (intervalStr.endsWith('s')) {
    intervalMs = parseInt(intervalStr) * 1000;
} else if (intervalStr.endsWith('h')) {
    intervalMs = parseInt(intervalStr) * 60 * 60 * 1000;
}

console.log(new Date(), "scheduling refresh every", intervalStr, `(${intervalMs}ms)`);

setInterval(() => {
    refresh();
}, intervalMs);

